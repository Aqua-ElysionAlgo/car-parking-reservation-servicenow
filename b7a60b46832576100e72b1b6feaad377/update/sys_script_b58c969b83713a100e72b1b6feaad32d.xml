<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script">
    <sys_script action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection>x_1869632_car_pa_0_car_parking_reservation_v2</collection>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>CPR - Sync to Jira</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {

	try {
		// 1. à¸ªà¸£à¹‰à¸²à¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢ (REST Message)
		var request = new sn_ws.RESTMessageV2();
		request.setHttpMethod('POST');
		
		// ]]>ðŸ”´<![CDATA[ à¹à¸à¹‰à¸¥à¸´à¸‡à¸à¹Œà¸•à¸£à¸‡à¸™à¸µà¹‰: à¹ƒà¸ªà¹ˆ Webhook URL à¸‚à¸­à¸‡à¸„à¸¸à¸“ (à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸ˆà¸²à¸ Jira)
		request.setEndpoint('https://api-private.atlassian.com/automation/webhooks/jira/a/ae84a2be-b99f-4972-9707-83e277489ad4/019b3541-4123-7b4e-9f71-1c9a0f0ed8e3'); 
		
		request.setRequestHeader('Content-Type', 'application/json');

		// 2. à¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¹ˆà¸‡ (Mapping)
		// à¸à¸±à¹ˆà¸‡à¸‹à¹‰à¸²à¸¢à¸„à¸·à¸­à¸Šà¸·à¹ˆà¸­à¸•à¸±à¸§à¹à¸›à¸£à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¹ˆà¸‡à¹„à¸› Jira (JSON Key)
		// à¸à¸±à¹ˆà¸‡à¸‚à¸§à¸²à¸„à¸·à¸­à¸Šà¸·à¹ˆà¸­ Field à¹ƒà¸™ ServiceNow (à¸•à¹‰à¸­à¸‡à¸•à¸£à¸‡à¸à¸±à¸š Database name)
		
		var body = {
			"jira_key": current.correlation_id.toString(),      // à¸à¸¸à¸à¹à¸ˆà¸ªà¸³à¸„à¸±à¸ (à¸«à¹‰à¸²à¸¡à¸¥à¸š)
			
			"req_name": current.cpr_requester_name.toString(),  // à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ˆà¸­à¸‡
			"req_phone": current.cpr_requester_phone.toString(),// à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£
			"req_email": current.cpr_requester_email.toString(),// à¸­à¸µà¹€à¸¡à¸¥
			
			"car_type": current.cpr_car_type.getDisplayValue(), // à¸›à¸£à¸°à¹€à¸ à¸—à¸£à¸– (à¹ƒà¸Šà¹‰ getDisplayValue à¹€à¸žà¸·à¹ˆà¸­à¹€à¸­à¸²à¸Šà¸·à¹ˆà¸­ à¹„à¸¡à¹ˆà¹€à¸­à¸² ID)
			"plate_no": current.cpr_vehicle_reg_no.toString(),  // à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸£à¸–
			
			"location": current.cpr_location.getDisplayValue(), // à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸ˆà¸­à¸”
			
			"start_time": current.cpr_startdate.toString(),    // à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡
			"end_time": current.cpr_enddate.toString()         // à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”
		};

		// 3. à¸ªà¹ˆà¸‡à¸­à¸­à¸à¹„à¸›
		request.setRequestBody(JSON.stringify(body));
		var response = request.execute();
		
		// (Optional) à¹€à¸Šà¹‡à¸„ Log à¸§à¹ˆà¸²à¸ªà¹ˆà¸‡à¸œà¹ˆà¸²à¸™à¹„à¸«à¸¡ à¸”à¸¹à¹„à¸”à¹‰à¸—à¸µà¹ˆ System Logs
		// gs.info('Sent to Jira: ' + response.getBody());

	} catch (ex) {
		gs.info('Error sending to Jira: ' + ex.message);
	}

})(current, previous);]]></script>
        <sys_class_name>sys_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-12-19 06:40:46</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>b58c969b83713a100e72b1b6feaad32d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>CPR - Sync to Jira</sys_name>
        <sys_overrides/>
        <sys_package display_value="Car Parking Reservation" source="x_1869632_car_pa_0">b7a60b46832576100e72b1b6feaad377</sys_package>
        <sys_policy/>
        <sys_scope display_value="Car Parking Reservation">b7a60b46832576100e72b1b6feaad377</sys_scope>
        <sys_update_name>sys_script_b58c969b83713a100e72b1b6feaad32d</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-12-19 06:40:46</sys_updated_on>
        <template/>
        <when>after</when>
    </sys_script>
    <sys_translated_text action="delete_multiple" query="documentkey=b58c969b83713a100e72b1b6feaad32d"/>
</record_update>
